<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<title>NixOS Update Tracker</title>
</head>
<body>

<div class="container-fluid">

<h1>NixOS (unstable) Update Tracker</h1>


<button class="btn" aria-fn="./stable.json">Stable git (updates)</button>
<button class="btn" aria-fn="./stable-cve.json">Stable (updates, only CVEs)</button>
<button class="btn" aria-fn="./unstable.json">Unstable (updates)</button>
<button class="btn" aria-fn="./unstable-cve.json">Unstable (updates, only CVEs)</button>

<table class="table">
<thead class="thead-dark">
<tr>
<th scope="col">NixPkg</th>
<th scope="col">PkgName</th>
<th scope="col">NixVersion</th>
<th scope="col">Upstream Version</th>
<th scope="col">Homepage</th>
<th scope="col">CVEs</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.min.js"integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="	 crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

<script type="application/javascript">
var tbody = $("tbody");
var add = function(pkg) {
   var row = $("<tr/>");
   row.append($("<td>").text(pkg.NixName));
   row.append($("<td>").text(pkg.PkgName));
   row.append($("<td>").text(pkg.NixVersion));
   row.append($("<td>").text(pkg.TrackerVersion));
   row.append($("<td>").append($("<a>").attr("href",pkg.Homepage).text(pkg.Homepage)));
   row.append($("<td>").text(pkg.CVEs.join(",")));
   tbody.append(row);
};

var cache = {};

function load(fn) {
	if (cache[fn]) {
		display(cache[fn])
	} else {
		$.get(fn, function(data) {
			cache[fn] = data;
			display(data);
		});
	}
}
$("button").each(function() {
  $(this).on("click", function() {
    tbody.empty();
    load($(this).attr('aria-fn'));
  });
});

function display(data) {
	var keys = Object.keys(data);
	keys.sort(function keyOrder(k1, k2){
		k1 = k1.toLowerCase(), k2 = k2.toLowerCase();
		if (k1 < k2) return -1;
		else if (k1 > k2) return +1;
		else return 0;
	});
	for (var key of keys) {
		if (data.hasOwnProperty(key))
			add(data[key]);
	}
}

</script>

</body>
</html>
